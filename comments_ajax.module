<?php

/**
 * Implement hook_menu
 */
function comments_ajax_menu() {
  $items = array();
  $items['comments/get'] = array(
    'title' => 'Dynamic comments',
    'page callback' => 'comments_ajax_load',
    'access arguments' => array('access content'),
    'type' => MENU_CALLBACK
  );
  return $items;
}

function comments_ajax_load($nid){
  // Call the views_embed_view function to returned themed view output
  $res = views_embed_view('newsfeed_comment', 'block_2', array($nid));
  // create a JSON object. The object will contain a property named “products” that will be set with the themed result of the executed view. 
  return drupal_json(array('comments'=>$res));
  exit;
}

/**
 * Implement hook_theme().
 */
function comments_ajax_theme() {
   return array(
      'comments_ajax_javascript' => array(
         'arguments' => array(),
      ),
   );   
}

/**
 * Implement hook_init().
 */
function comments_ajax_init() {
  theme('comments_ajax_javascript');
}

function theme_comments_ajax_javascript() {
  drupal_add_js(drupal_get_path('module', 'comments_ajax') . '/comments_ajax.js');
}
